{% extends "layouts/header.html" %}
{% block content %}

<div class="grid-container-1 min-h-screen">
  <header class="w3-container">
    <h1 class="text-style">Update Records</h1>  
  </header>

  <div class="wrapper">
    <input class="radio" id="one" name="group" type="radio" checked>
    <input class="radio" id="two" name="group" type="radio">
    <input class="radio" id="three" name="group" type="radio">
    <input class="radio" id="four" name="group" type="radio">
    <input class="radio" id="five" name="group" type="radio">
    <!-- <div class="flex-tab"> -->
      <div class="tabs flex-tab">
          <label class="tab" onclick="switchTab('tab1')" data-tab="tab1" id="one-tab" for="one">Import Users</label>
          <label class="tab" onclick="switchTab('tab2')" data-tab="tab2" id="two-tab" for="two">Update User</label>
          <label class="tab" onclick="switchTab('tab3')" data-tab="tab3" id="three-tab" for="three">Update College</label>
          <label class="tab" onclick="switchTab('tab4')" data-tab="tab4" id="four-tab" for="four">Update Department</label>
          <label class="tab" onclick="switchTab('tab5')" data-tab="tab5" id="five-tab" for="five">Update User Type</label>
        </div>
    <!-- </div> -->
    <div class="panels panel-relative mx-auto mb-5">
      <div class="panel" id="tab1">
        <div class="flex justify-between items-center mb-5">
          <div class="panel-title">Add New Data</div>
          <div class="d-grid-md-flex justify-content-md-end">
           
            <button class="btn btn-primary me-md-2" type="button">Batch Upload</button>
            
          </div>
        </div>
        <hr>
        <form class="panel-margin" method="post">
          {% csrf_token %}
          <div class="row mb-3">
            <label class="col-sm-2 col-form-label" for="customFile">Upload Picture</label>
            <div class="col-sm-10">
              <input type="file" class="form-control" id="customFile" required />
            </div>
          </div>
          <div class="row mb-3">
            <label class="col-sm-2 col-form-label" for="idnum">ID Number:</label>
            <div class="col-sm-10">
              <input class="form-control" type="text" id="idnum" name="idnum" required>
            </div>
          </div>
          <div class="row mb-3">
            <label class="col-sm-2 col-form-label" for="idnum">Alternative Number:</label>
            <div class="col-sm-10">
              <input class="form-control" type="text" id="altid" name="altid" required>
            </div>
          </div>
          <div class="row mb-3">
            <label class="col-sm-2 col-form-label" for="fname">First name:</label>
            <div class="col-sm-10">
              <input class="form-control" type="text" id="fname" name="fname" required>
            </div>
          </div>
          <div class="row mb-3">
            <label class="col-sm-2 col-form-label" for="mname">Middle name:</label>
            <div class="col-sm-10">
              <input class="form-control" type="text" id="mname" name="mname" required>
            </div>
          </div>
          <div class="row mb-3">
            <label class="col-sm-2 col-form-label" for="lname">Last name:</label>
            <div class="col-sm-10">
              <input class="form-control" type="text" id="lname" name="lname" required>
            </div>
          </div>
          <div class="row mb-3">
          <label class="col-sm-2 col-form-label" for="gender">Gender:</label>
            <div class="col-sm-10">
              <div class="btn-group" role="group" aria-label="Basic radio toggle button group">
                <input type="radio" class="btn-check" id="btnradio1" name="gender" value="M" required>
                <label class="btn btn-outline-primary" for="btnradio1">Male</label>
              
                <input type="radio" class="btn-check" id="btnradio2" name="gender" value="F" required>
                <label class="btn btn-outline-primary" for="btnradio2">Female</label>
              </div>
            </div>
          </div>
          <div class="row mb-3">
          <label class="col-sm-2 col-form-label" for="department">Department:</label>
            <div class="col-sm-10">
                <input class="form-select" autocomplete="off" role="combobox" list="" id="searchinput" name="data_list" placeholder="Search department" required>
                  <datalist id="data_list" role="listbox" style="z-index: 9999; width: 95.5%;">
                    {% for item in dept %}
                      <option value="{{item.department_name}}"> {{ item.department_name }} </option>  
                    {% endfor %}  
                  </datalist>    
            </div>

          </div>
          <div class="row mb-3">
            <label class="col-sm-2 col-form-label" for="department">Course:</label>
              <div class="col-sm-10">
                {% if course %}
                <select class="form-select" aria-label="Default select example" name="courses"> 
                  {% for item in course %}
                    <option value="{{item}}"> {{ item }} </option>
                  {% endfor %}
                  <option onclick="checkAndAddOption(this)" value="">Add New </option>
                </select>
                <div id="inputnew"></div> 
                {% else %}
                  <div>
                    <input class="form-control" type="text" id="course" name="courses" required>
                  </div> 
                {% endif %}
              </div>
            </div>
            <div class="row mb-3">
              <label class="col-sm-2 col-form-label" for="department">User Type:</label>
                <div class="col-sm-10">
                  <select class="form-select" aria-label="Default select example" name="usertype_select">
                    {% for item in usertype %}
                      <option value="{{item.type_id}}"> {{ item.type_name }} </option>
                    {% endfor %}
                  </select>
                </div>
              </div>
              <div class="row mb-3">
                <label class="col-sm-2 col-form-label" for="department">Comment:</label>
                  <div class="col-sm-10">
                    <div class="form-floating">
                      <textarea class="form-control" placeholder="Leave a comment here" id="floatingTextarea" name="comments"></textarea>
                      <label for="floatingTextarea">Comments</label>
                    </div>
                  </div>
                </div>
                <div class="d-grid col-4 mx-auto">
                  <button class="btn btn-primary" type="submit">Save</button>
                </div>
        </form>
      </div>
      <div class="panel" id="tab2">
        <div class="row">
            <div class="col-md-6 offset-md-3">
                <div class="form-group">
                  <label for="start-date">Search user: (By ID Number or Last Name)</label>
                  <input type="text" class="form-control" placeholder="ex. CO2019-1-1190" name="user_update" id="user_input" required>
                </div>
            </div>
        </div>
        <div id="table-click" class="justify-content-center">
          <table id="table-data" class="table table-bordered table-hover">
            <thead class="thead-dark">
              <tr class="text-center">
                <th>ID Number</th>
                <th>Name</th>
                <th>Department</th>
              </tr>
            </thead>
            <tbody>
              {% for item in users %}
              <tr>
                  <td>{{item.user_idno}}&nbsp<i id="icon-eye{{forloop.counter}}" class="fa fa-eye"></i></i></td>
                  <td>{{item.last_name}}, {{item.firstname|title}} {{item.middle_name}}</td>
                  <td>{{item.department.department_name}}</td>
                  <form id="input_user{{forloop.counter}}" method="post"> 
                    {% csrf_token %}
                    <input type="text" value="{{item.user_idno}}" name="input_user_samp" hidden>
                  </form>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>  

        <div id="content-eye" style="display: none;">
          <form class="panel-margin" method="post">
            <div style="display:flex; justify-content: end">
              <button class="btn-delete btn-primary me-md-2" id="myBtn" type="button">Delete</button>
            </div>
            <div id="myModal" class="modal">
              <!-- Modal content -->
              <div class="modal-content">
                  <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                    <button id="close-modal" type="button" class="btn-close" id="close-modal" aria-label="Close"></button>
                  </div>
                <div class="confirm-message">Are you sure you want to delete the USER?</div>
                <div class="confirm-actions">
                  <button class="btn-delete mr-2 btn-primary" type="submit">Yes</button>
          
                  <button class="btn btn-primary" id="close-modal" type="submit">No</button>
                </div>
              </div>
          
            </div>
            <hr>
            {% csrf_token %}
            <div class="row mb-3">
              <label class="col-sm-2 col-form-label" for="customFile">Upload Picture</label>
              <div class="col-sm-10">
                <input type="file" class="form-control" id="customFile"/>
              </div>
            </div>
            <div class="row mb-3">
              <label class="col-sm-2 col-form-label" for="idnum">ID Number:</label>
              <div class="col-sm-10">
                <input class="form-control" type="text" id="idnum" name="idnum-update" required>
              </div>
            </div>
            <div class="row mb-3">
              <label class="col-sm-2 col-form-label" for="idnum">Alternative Number:</label>
              <div class="col-sm-10">
                <input class="form-control" type="text" id="idnum" name="alt-id-update" required>
              </div>
            </div>
            <div class="row mb-3">
              <label class="col-sm-2 col-form-label" for="fname">First name:</label>
              <div class="col-sm-10">
                <input class="form-control" type="text" id="fname" name="fname-update" required>
              </div>
            </div>
            <div class="row mb-3">
              <label class="col-sm-2 col-form-label" for="mname">Middle name:</label>
              <div class="col-sm-10">
                <input class="form-control" type="text" id="mname" name="mname-update" required>
              </div>
            </div>
            <div class="row mb-3">
              <label class="col-sm-2 col-form-label" for="lname">Last name:</label>
              <div class="col-sm-10">
                <input class="form-control" type="text" id="lname" name="lname-update" required>
              </div>
            </div>
            <div class="row mb-3">
            <label class="col-sm-2 col-form-label" for="gender">Gender:</label>
              <div class="col-sm-10">
                <div class="btn-group" role="group" aria-label="Basic radio toggle button group">
                  <input type="radio" class="btn-check" id="btnradio3" name="gender-update" value="M" required>
                  <label class="btn btn-outline-primary" for="btnradio3">Male</label>
          
                  <input type="radio" class="btn-check" id="btnradio4" name="gender-update" value="F" required>
                  <label class="btn btn-outline-primary" for="btnradio4">Female</label>
                </div>
              </div>
            </div>

            
            <div class="row mb-3">
            <label class="col-sm-2 col-form-label" for="department">Department:</label>
              <div class="col-sm-10">
                <select class="form-select" aria-label="Default select example" name="data_list">
                  {% for item in dept %}
                    <option value="{{item.department_name}}"> {{ item.department_name }} </option>
                  {% endfor %}
                </select>
              </div>
            </div>
            <div class="row mb-3">
              <label class="col-sm-2 col-form-label" for="department">Course:</label>
                <div class="col-sm-10">
                  {% if course %}
                  <select class="form-select" aria-label="Default select example" name="courses-update" onclick="checkAndAddOption(this)"> 
                    {% for item in course %}
                      <option value="{{item}}"> {{ item }} </option>
                    {% endfor %}
                    <option onclick="checkAndAddOption(this)" value="">Add New </option>
                  </select>
                  <div id="inputnew"></div> 
                  {% else %}
                    <div>
                      <input class="form-control" type="text" id="course" name="courses-update" required>
                    </div> 
                  {% endif %}
                </div>
              </div>
              <div class="row mb-3">
                <label class="col-sm-2 col-form-label" for="department">User Type:</label>
                  <div class="col-sm-10">
                    <select class="form-select" aria-label="Default select example" name="usertype_select-update">
                      {% for item in usertype %}
                        <option value="{{item.type_id}}"> {{ item.type_name }} </option>
                      {% endfor %}
                    </select>
                  </div>
                </div>
                <div class="row mb-3">
                  <label class="col-sm-2 col-form-label" for="department">Comment:</label>
                    <div class="col-sm-10">
                      <div class="form-floating">
                        <textarea class="form-control" placeholder="Leave a comment here" id="floatingTextarea" name="comments-update"></textarea>
                        <label for="floatingTextarea">Comments</label>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="d-grid col-4 mx-auto">
                      <button class="btn-cancel" type="submit">Cancel</button>
                    </div>
                    <div class="d-grid col-4 mx-auto">
                      <button class="btn btn-primary" type="submit">Save</button>
                    </div>
                  </div>
          </form>
        </div>
        
      </div>
      <div class="panel" id="tab3">
        <!-- <div class="panel-title">Note on Prerequisites</div> -->
        <div class="row mb-3">
          <form action="/admin/dashboard/updaterecord/" method="post" name="add_college_form">
            {% csrf_token %}
          <div class="input-group">
            <label class="col-sm-2 col-form-label" for="college">Add a College:</label>
            <input type="text" class="form-control" value="College of " aria-label="College of" aria-describedby="basic-addon2" name="college" required>
            <div class="input-group-button">
              <button class="btn-update btn-outline-secondary" type="submit">Add</button>
            </div>
          </div>   
          </form>  
        </div>
        <form method="post" name="update_college_form"> 
          {% csrf_token %}
          <div class="row mb-3">
            <div class="input-group">
            <label class="col-sm-2 col-form-label" for="department">Update a College:</label>
              <select class="form-select" aria-label="Default select example" name="college_name">
                {% for item in data %}
                  <option value="{{item.college_name}}"> {{ item.college_name }} </option>
                {% endfor %}
              </select>
            </div>
          </div>
          <div class="row mb-3">
            <div class="input-group">
              <label class="col-sm-2 col-form-label" for="fname">New College Name:</label>
              <input type="text" class="form-control" value="College of " aria-label="College of" aria-describedby="basic-addon2" name="new_college_name" required>
              <div class="input-group-button">
                <button class="btn-update btn-outline-secondary" type="submit">Update</button>
              </div>
            </div>     
          </div>
        </form>
        <div class="row mb-3">
          <form method="post">
            {% csrf_token %}
            <div class="input-group">
              <label class="col-sm-2 col-form-label" for="delete_college">Delete a College:</label>
              <select class="custom-select" name="delete_college">
                {% for item in data %}
                  <option value="{{item.college_name}}"> {{ item.college_name }} </option>
                {% endfor %}
              </select>
              <div class="input-group-button">
                <button class="btn-delete btn-outline-secondary" type="submit">Delete</button>
              </div>
            </div>
          </form>
          </div>
          {% if messages %}
          <p class="messages">
              {% for message in messages %}
              <p style="color: red; text-align: center; font-weight: bold;" {% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message.message }}</p>
              {% endfor %}
          </p>
          {% endif %}
        </div>
   
      <div class="panel" id="tab4">
        <!-- <div class="panel-title">Note on Prerequisites</div> -->
        <form method="post">
          {% csrf_token %}
          <div class="row mb-3">
            <div class="input-group">
              <label class="col-sm-2 col-form-label" for="dept">Add a Department:</label>
              <input type="text" class="form-control" value="Department of " aria-label="Department of" aria-describedby="basic-addon2" name="dept" required>
              <div class="input-group-button">
                <button class="btn-update btn-outline-secondary" type="submit">Add</button>
              </div>
            </div>     
          </div>
          <div class="row mb-3">
            <div class="input-group">
            <label class="col-sm-2 col-form-label" for="department">From College of:</label>
                <select class="form-select" aria-label="Default select example" name="from_college">
                {% for item in data %}
                  <option value="{{item.college_name}}"> {{ item.college_name }} </option>
                {% endfor %}
                </select>
            </div>
          </div>
        </form>
        <form method="post"> 
          {% csrf_token %}
        <div class="row mb-3">
          <div class="input-group">
          <label class="col-sm-2 col-form-label" for="department">Update a Department:</label>
              <select class="form-select" aria-label="Default select example" name="update_dept_form">
                {% for item in dept %}
                  <option value="{{item.department_name}}"> {{ item.department_name }} </option>
                {% endfor %}
              </select>
          </div>
        </div>
        <div class="row mb-3">
          <div class="input-group">
            <label class="col-sm-2 col-form-label" for="fname">New department Name:</label>
            <input type="text" class="form-control" value="Department of " aria-label="Department of" aria-describedby="basic-addon2" name="new_dept_name" required>
            <div class="input-group-button">
              <button class="btn-update btn-outline-secondary" type="submit">Update</button>
            </div>
          </div>     
        </div>
      </form>
      <form method="post">
        {% csrf_token %}
        <div class="row mb-3">
          <div class="input-group">
            <label class="col-sm-2 col-form-label" for="delete_dept">Delete a Department:</label>
            <select class="custom-select" id="inputGroupSelect04" name="delete_dept">
              {% for item in dept %}
                <option value="{{item.department_name}}"> {{ item.department_name }} </option>
              {% endfor %}
            </select>
            <div class="input-group-button">
              <button class="btn-delete btn-outline-secondary" type="submit">Delete</button>
            </div>
          </div>
          </div>
        </form>
        </div>
      
      <div class="panel" id="tab5">
        <!-- <div class="panel-title">Note on Prerequisites</div> -->
        <form method="post">
        {% csrf_token %}
          <div class="row mb-3">
            <div class="input-group">
              <label class="col-sm-2 col-form-label" for="fname">Add User Type</label>
              <input type="text" class="form-control" placeholder="" aria-label="College of" aria-describedby="basic-addon2" name="usertype" required>
              <div class="input-group-button">
                <button class="btn-update btn-outline-secondary" type="submit">Add</button>
              </div>
            </div>     
          </div>
        </form>
        <div class="d-flex justify-content-center">
          <table class="table table-striped table-bordered table-hover">
            <thead class="thead-dark">
              <tr class="text-center">
                <th>User ID</th>
                <th>User Type</th>
              </tr>
            </thead>
            <tbody>
              {% for item in usertype %}
              <tr>
                <td>{{item.type_id}}</td>
                <td>{{item.type_name}}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>        
      </div>
      </div>
    </div>

<style>
  .confirm-btn {
  padding: 10px 20px;
  font-size: 16px;
  border-radius: 5px;
  border: none;
  cursor: pointer;
  background-color: #007bff;
  color: white;
  }

  .confirm-popup {
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: white;
  box-shadow: 0 0 10px #ccc;
  padding: 20px;
  }

  .confirm-message {
  font-size: 18px;
  margin-bottom: 20px;
  text-align: center;
  font-weight: bold;
  }

  .confirm-actions {
  display: flex;
  justify-content: center;
  text-align: center;
  }


  .confirm-yes {
  padding: 10px 20px;
  font-size: 16px;
  border-radius: 5px;
  border: none;
  cursor: pointer;
  background-color: green;
  color: white;
  }

  .confirm-no {
  padding: 10px 20px;
  font-size: 16px;
  border-radius: 5px;
  border: none;
  cursor: pointer;
  background-color: red;
  color: white;
  }

  /* The Modal (background) */
  .modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
  backdrop-filter: blur(2px);
  }

  /* Modal Content */
  .modal-content {
  background-color: #fefefe;
  margin: 15% auto; /* 15% from the top and centered */
  padding: 20px;
  border: 1px solid #888;
  width: 40%; /* Could be more or less, depending on screen size */
  }



  /* The Close Button */
  /* The Close Button */
  .close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
  }


  .close:hover,
  .close:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
  }

  
fieldset {
  border: 1px solid blue;
  width: 360px;
  border-radius: 5px;
}

legend{
  color: blue; 
  font-size: 24px;
  font-family: sans-serif;
}

.search-input {
  font-size: 18px;
  padding: 5px;
  height: 35px;
  width: 350px;
  border: 1px solid blue;
  outline: none;
  border-radius: 5px;
  color: black;
/*   border-bottom: none; */
}
datalist {
  position: absolute;
  background-color: white;
  border: .5px solid rgb(128, 128, 128);
  border-radius: 0 0 5px 5px;
  border-top: none;
  font-family: sans-serif;
  width: 350px;
  padding: 5px;
  max-height: 10rem;
  overflow-y: auto
  
}

option {
  background-color: white;
  padding: 4px;
  color: black;
  margin-bottom: 1px;
   font-size: 18px;
  cursor: pointer;
}

option:hover,  .active{
  background-color: rgb(225, 225, 225);
}
</style>

<script>
          sessionStorage?.removeItem("activeTabSearch");
          sessionStorage?.removeItem("activeTabManageReport");

document.addEventListener("DOMContentLoaded", function() {
      document.querySelectorAll("[id^='icon-eye']").forEach(function(el) {
          // Add an event listener to each element
          el.addEventListener("click", function(event) {
            document.querySelector("#table-click").style.display = "none"
            var table, tr, td;
            table = document.getElementById("table-data");
            tr = table.getElementsByTagName("tr");
            stringReplace = el.id.replace("icon-eye", "")
            event.preventDefault();
            var myForm = document.querySelector('#input_user'+stringReplace);
            var formData = new FormData(myForm);
            fetch('/admin/dashboard/updaterecord/', {
              method: 'POST',
              body: formData
            }).then(response => response.json())
            .then(data => {
            })
            var td_show = tr[stringReplace].getElementsByTagName("td")[0];
            var td_show1 = tr[stringReplace].getElementsByTagName("td")[1];
            var td_show2 = tr[stringReplace].getElementsByTagName("td")[2];
            document.querySelector("#content-eye").style.display = 
            document.querySelector("#content-eye").style.display === "none" ? "block" : "none";
          });
      });
    });

var activeTab = sessionStorage.getItem("activeTab");

    // If there is no active tab, set the first tab as the active tab
    if (!activeTab) {
      activeTab = "tab1";
      document.getElementById("one").checked = true;
      sessionStorage.setItem("activeTab", activeTab);
    }
    if (activeTab == "tab1") {
      document.getElementById("one").checked = true;
    
    }else if (activeTab == "tab2"){ 
      document.getElementById("two").checked = true;
    
    }else if (activeTab == "tab3"){ 
      document.getElementById("three").checked = true;
 
    }else if (activeTab == "tab4"){ 
      document.getElementById("four").checked = true;
    
    }else {
      document.getElementById("five").checked = true;
    }

    // Show the active tab and hide the other tabs
    document.getElementById(activeTab).style.display = "block";
    for (var i = 1; i <= 5; i++) {
      if ("tab" + i != activeTab) {
        document.getElementById("tab" + i).style.display = "none";
      }
    }

    // Function to switch tabs
    function switchTab(tabId) {
      document.getElementById(activeTab).style.display = "none";
      document.getElementById(tabId).style.display = "block";
      activeTab = tabId;
      sessionStorage.setItem("activeTab", activeTab);
    }


  var closeModalBtn = document.getElementById("close-modal");
    closeModalBtn.addEventListener("click", function() {
      var modalContainer = document.querySelector(".modal");
      modalContainer.style.display = "none";
  });

document.getElementById("user_input").addEventListener("input", searchTable);
if (document.getElementById("user_input").value === "") {
      document.getElementById("table-data").style.display = "none"
    }

function searchTable() {
  $("#table-data-show tbody tr").remove(); 
      document.querySelector("#table-click").style.display = ""
      document.querySelector("#content-eye").style.display = "none"

  document.getElementById("table-data").style.display = ""
  var input, filter, table, tr, td, i, txtValue, td1, txtValue1;
      input = document.getElementById("user_input");
      filter = input.value.toUpperCase().replace(/[^a-z0-9]/gi, "");
      table = document.getElementById("table-data");
      tr = table.getElementsByTagName("tr");
      if (filter === '') { // Check if input field is empty
        document.getElementById("table-data").style.display = "none"
      } 
      else {
        for (i = 0; i < tr.length; i++) {
          td = tr[i].getElementsByTagName("td")[0];
          td1 = tr[i].getElementsByTagName("td")[1];
          if (td && td1) {
            txtValue = td.textContent.replace(/[^a-z0-9]/gi, "") || td.innerText.replace(/[^a-z0-9]/gi, "");
            txtValue1 = td1.innerText.replace(/[^a-z0-9]/gi, "") || td1.textContent.replace(/[^a-z0-9]/gi, "");
            if (txtValue.toUpperCase().replace(/[^a-z0-9]/gi, "").startsWith(filter) || txtValue1.toUpperCase().replace(/[^a-z0-9]/gi, "").startsWith(filter)) {
              tr[i].style.display = "";
            } else {
              tr[i].style.display = "none";
            }
          }
        }
    }
  }
  function checkAndAddOption(selectElement) {
      if (selectElement.value === "") {
        var div1=document.getElementById("inputnew");
        div1.innerHTML="<input type='text' name='courses1' id='courses1'/>";
        
      }
      else {
        var div1=document.getElementById("inputnew");
        div1.innerHTML="";
      }
  }

  searchinput.onfocus = function () {
  data_list.style.display = 'block';
  searchinput.style.borderRadius = "5px 5px 0 0";  
};
for (let option of data_list.options) {
  option.onclick = function () {
    searchinput.value = option.value;
    data_list.style.display = 'none';
    searchinput.style.borderRadius = "5px";
  }
};

searchinput.oninput = function() {
  currentFocus = -1;
  var text = searchinput.value.toUpperCase();
  for (let option of data_list.options) {
    if(option.value.toUpperCase().indexOf(text) > -1){
      option.style.display = "block";
  }else{
    option.style.display = "none";
    }
  };
}

var datalist = document.getElementById('data_list');
var input = document.getElementById('searchinput');

document.addEventListener('click', (event) => {
  const target = event.target;
  
  // if the click target is not the input or an option in the datalist, hide the datalist
  if (target !== input && !datalist.contains(target)) {
    datalist.style.display = 'none';
  }
});

input.addEventListener('focus', () => {
  datalist.style.display = 'block';
});

var currentFocus = -1;
searchinput.onkeydown = function(e) {
  if(e.keyCode == 40){
    currentFocus++
   addActive(data_list.options);
  }
  else if(e.keyCode == 38){
    currentFocus--
   addActive(data_list.options);
  }
  else if(e.keyCode == 13){
    e.preventDefault();
        if (currentFocus > -1) {
          /*and simulate a click on the "active" item:*/
          if (data_list.options) data_list.options[currentFocus].click();
        }
  }
}

function addActive(x) {
    if (!x) return false;
    removeActive(x);
    if (currentFocus >= x.length) currentFocus = 0;
    if (currentFocus < 0) currentFocus = (x.length - 1);
    x[currentFocus].classList.add("active");
  }
  function removeActive(x) {
    for (var i = 0; i < x.length; i++) {
      x[i].classList.remove("active");
    }
  }

   // Get the modal
   var modal = document.getElementById("myModal");
  
  // Get the button that opens the modal
  var btn = document.getElementById("myBtn");
  
  // Get the <span> element that closes the modal
  var span = document.getElementsByClassName("close")[0];
  
  // When the user clicks the button, open the modal 
  btn.onclick = function() {
    modal.style.display = "block";
  }
  
  // When the user clicks on <span> (x), close the modal
  span.onclick = function() {
    modal.style.display = "none";
  }
  
  // When the user clicks anywhere outside of the modal, close it
  window.onclick = function(event) {
    if (event.target == modal) {
      modal.style.display = "none";
    }
  }
</script>
</div>
{% endblock content %}