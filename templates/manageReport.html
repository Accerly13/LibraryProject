{% extends "layouts/header.html" %}
{% block content %}
<div class="grid-container-1 min-h-screen">
  <header class="w3-container">
    <h1 class="text-style">Manage Reports</h1>  
  </header>
  <div class="wrapper" style="background-color: #ECF0F1">
    <input class="radio" id="one" name="group" type="radio" checked>
    <input class="radio" id="two" name="group" type="radio">
    <input class="radio" id="three" name="group" type="radio">
    <input class="radio" id="four" name="group" type="radio">
    <!-- <div class="flex-tab"> -->
      <div class="tabs flex-tab">
          <label class="tab" onclick="switchTab('tab1')" data-tab="tab1" id="one-tab" for="one">Student</label>
          <label class="tab" onclick="switchTab('tab2')" data-tab="tab2" id="two-tab" for="two">Faculty</label>
          <label class="tab" onclick="switchTab('tab3')" data-tab="tab3" id="three-tab" for="three">Personnel</label>
          <label class="tab" onclick="switchTab('tab4')" data-tab="tab4" id="four-tab" for="four">Overall</label>
        </div>
    <!-- </div> -->
    <div class="panels panel-relative mx-auto mb-5">
      <div class="panel" id="tab1">
        <form id="generate-list" method="post">
          {% csrf_token %}
        <div class="row">
            <div class="col-md-6 offset-md-3">
              <div class="form-group">
                <label for="start-date">Start Date:</label>
                <input type="text" class="form-control" id="start-date" placeholder="mm/dd/yyyy" required name="start-date-student">
              </div>
            </div>
          </div>
          
          <div class="row">
            <div class="col-md-6 offset-md-3">
              <div class="form-group">
                <label for="end-date">End Date:</label>
                <input type="text" class="form-control" id="end-date" placeholder="mm/dd/yyyy" required name="end-date-student">
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 offset-md-3">
              <div class="form-group">
                <label for="start-time">Start Time:</label>
                <input type="time" class="form-control" id="start-time" placeholder="hh:mm" required name="start-time-student">
              </div>
            </div>
          </div>
          
          <div class="row">
            <div class="col-md-6 offset-md-3">
              <div class="form-group">
                <label for="end-time1">End Time:</label>
                <input type="time" class="form-control" id="end-time1" placeholder="hh:mm" required name="end-time-student">
              </div>
            </div>
          </div>
          <div class="d-flex justify-content-center"style="padding-bottom: 1rem;">
            <button class="btn btn-primary" onclick="generateButton()">Generate</button>
          </div>
          </form>
          <div class="d-flex justify-content-center">
            <table id="students-rendered" class="table table-striped table-bordered table-hover">
              <thead class="thead-dark">
                <!-- <tr class="text-center">
                  <th colspan="5">Generated report from 1/23/23 to 2/23/23 from 6:00am to 7:00pm</th>
                </tr> -->
              </thead>
              <tbody>
                <!-- <tr class="text-center">
                  <th>Colleges</th>
                  <th>Departments</th>
                  <th>Total number of students</th>
                </tr>
                <tr class="text-center">
                  <th>Computer Science</th>
                  <th>Computer Studies</th>
                  <th>200</th>
                </tr> -->
              </tbody>
            </table>
          </div>

          <div class="row" style="display: flex; justify-content: space-evenly;">
            Choose where to export:
            <div class="col-md-6 offset-md-1">
              <div class="form-group">
                <input type="radio" name="exportype" value="pdfone" checked> PDF &nbsp&nbsp
                <input type="radio" name="exportype" value="csvone"> CSV &nbsp&nbsp
                <button class="btn btn-primary">Export report</button>
              </div>
            </div>
          </div>

      </div>
      <div class="panel" id="tab2">
        <div class="row">
            <div class="col-md-6 offset-md-3">
              <div class="form-group">
                <label for="start-date1">Start Date:</label>
                <input type="text" class="form-control" id="start-date1" placeholder="mm/dd/yyyy" required name="start-date-faculty">
              </div>
            </div>
          </div>
          
          <div class="row">
            <div class="col-md-6 offset-md-3">
              <div class="form-group">
                <label for="end-date1">End Date:</label>
                <input type="text" class="form-control" id="end-date1" placeholder="mm/dd/yyyy" required name="end-date-faculty">
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 offset-md-3">
              <div class="form-group">
                <label for="start-time">Start Time:</label>
                <input type="time" class="form-control" id="start-time" placeholder="hh:mm" required name="start-time-faculty">
              </div>
            </div>
          </div>
          
          <div class="row">
            <div class="col-md-6 offset-md-3">
              <div class="form-group">
                <label for="end-time">End Time:</label>
                <input type="time" class="form-control" id="end-time" placeholder="hh:mm" required name="end-time-faculty">
              </div>
            </div>
          </div>
          <div class="d-flex justify-content-center"style="padding-bottom: 1rem;">
            <button class="btn btn-primary">Generate</button>
          </div>

          <div class="d-flex justify-content-center">
            <table class="table table-striped table-bordered table-hover">
              <thead class="thead-dark">
                <tr class="text-center">
                  <th colspan="5">Generated report from 1/23/23 to 2/23/23 from 6:00am to 7:00pm</th>
                </tr>
              </thead>
              <tbody>
                <tr class="text-center">
                  <th>Colleges</th>
                  <th>Departments</th>
                  <th>Total number of faculty</th>
                </tr>
                <tr class="text-center">
                  <th>Computer Science</th>
                  <th>Computer Studies</th>
                  <th>200</th>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="row" style="display: flex; justify-content: space-evenly;">
            Choose where to export:
            <div class="col-md-6 offset-md-1">
              <div class="form-group">
                <input type="radio" name="exportype" value="pdftwo" checked required> PDF &nbsp&nbsp
                <input type="radio" name="exportype" value="csvtwo" required> CSV &nbsp&nbsp
                <button class="btn btn-primary">Export report</button>
              </div>
            </div>
          </div>

      </div>
      <div class="panel" id="tab3">
        <div class="row">
            <div class="col-md-6 offset-md-3">
              <div class="form-group">
                <label for="start-date3">Start Date:</label>
                <input type="text" class="form-control" id="start-date3" placeholder="mm/dd/yyyy" required name="start-date-personnel">
              </div>
            </div>
          </div>
          
          <div class="row">
            <div class="col-md-6 offset-md-3">
              <div class="form-group">
                <label for="end-date2">End Date:</label>
                <input type="text" class="form-control" id="end-date2" placeholder="mm/dd/yyyy" required name="end-date-personnel">
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 offset-md-3">
              <div class="form-group">
                <label for="start-time">Start Time:</label>
                <input type="time" class="form-control" id="start-time" placeholder="hh:mm" required name="start-time-personnel">
              </div>
            </div>
          </div>
          
          <div class="row">
            <div class="col-md-6 offset-md-3">
              <div class="form-group">
                <label for="end-time">End Time:</label>
                <input type="time" class="form-control" id="end-time" placeholder="hh:mm" required name="end-time-personnel">
              </div>
            </div>
          </div>
          <div class="d-flex justify-content-center"style="padding-bottom: 1rem;">
            <button class="btn btn-primary">Generate</button>
          </div>

          <div class="d-flex justify-content-center">
            <table class="table table-striped table-bordered table-hover">
              <thead class="thead-dark">
                <tr class="text-center">
                  <th colspan="5">Generated report from 1/23/23 to 2/23/23 from 6:00am to 7:00pm</th>
                </tr>
              </thead>
              <tbody>
                <tr class="text-center">
                  <th>Colleges</th>
                  <th>Departments</th>
                  <th>Total number of personnels</th>
                </tr>
                <tr class="text-center">
                  <th>Computer Science</th>
                  <th>Computer Studies</th>
                  <th>200</th>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="row" style="display: flex; justify-content: space-evenly;">
            Choose where to export:
            <div class="col-md-6 offset-md-1">
              <div class="form-group">
                <input type="radio" name="exportype" value="pdfthree" checked required> PDF &nbsp&nbsp
                <input type="radio" name="exportype" value="csvthree" required> CSV &nbsp&nbsp
                <button class="btn btn-primary">Export report</button>
              </div>
            </div>
          </div>

      </div>
         
      <div class="panel" id="tab4">

        <header style="font-size: 20px; font-weight: bold; color: rgb(41, 41, 41); margin: 1rem;">Semestral Report</header>

        <div class="row">
          <div class="col-md-6 offset-md-3">
          <div class="form-group">
            <input type="radio" name="schoolyear" value="intersession" checked required> Intersession &nbsp&nbsp
            <input type="radio" name="schoolyear" value="firstsem" required> First semester &nbsp&nbsp
            <input type="radio" name="schoolyear" value="secondsem" required> Second semester &nbsp&nbsp
          </div>
        </div>
          </div>

          <div style="text-align:center; font-size:  15px; font-weight: bold; color: rgb(41, 41, 41); margin: 1rem;">School Year
          </div>

          <div class="row">
            <div class="col-md-6 offset-md-3">
              <div class="form-group">
                <label for="start-date4">Start Year:</label>
                <input type="text" class="form-control" id="startyear" placeholder="Enter start year" required>
              </div>
            </div>
          </div>
          
          <div class="row">
            <div class="col-md-6 offset-md-3">
              <div class="form-group">
                <label for="end-date3">End Year:</label>
                <input type="text" class="form-control" id="endyear" placeholder="Enter end year" required>
              </div>
            </div>
          </div>

          <div class="d-flex justify-content-center">
            <button class="btn btn-primary">Export Report</button>
          </div>
      </div>
      </div>
      <script>
        if (sessionStorage.getItem("activeTabSearch")) {
          sessionStorage.removeItem("activeTabSearch");
        }


    var activeTab = sessionStorage.getItem("activeTabManageReport");

    // If there is no active tab, set the first tab as the active tab
    if (!activeTab) {
      activeTab = "tab1";
      document.getElementById("one").checked = true;
      sessionStorage.setItem("activeTabManageReport", activeTab);
    }
    if (activeTab == "tab1") {
      document.getElementById("one").checked = true;
    
    }else if (activeTab == "tab2"){ 
      document.getElementById("two").checked = true;
    
    }else if (activeTab == "tab3" ){ 
      document.getElementById("three").checked = true;
    
    }else{ 
      document.getElementById("four").checked = true;
    
    }

    // Show the active tab and hide the other tabs
    document.getElementById(activeTab).style.display = "block";
    for (var i = 1; i < 5; i++) {
      if ("tab" + i != activeTab) {
        document.getElementById("tab" + i).style.display = "none";
      }
    }

    // Function to switch tabs
    function switchTab(tabId) {
      document.getElementById(activeTab).style.display = "none";
      document.getElementById(tabId).style.display = "block";
      activeTab = tabId;
      sessionStorage.setItem("activeTabManageReport", activeTab);
    }

        $(document).ready(function() {
          $('#start-date').datepicker({
          autoclose: true,
          format: 'mm/dd/yyyy',
          startDate: null,
          endDate: new Date().toLocaleDateString('en-US', {
              month: '2-digit',
              day: '2-digit',
              year: 'numeric'
          })
        });
        
        $('#start-date1').datepicker({
          autoclose: true,
          format: 'mm/dd/yyyy',
          startDate: null,
          endDate: new Date().toLocaleDateString('en-US', {
              month: '2-digit',
              day: '2-digit',
              year: 'numeric'
          })
        });
        $('#start-date2').datepicker({
          autoclose: true,
          format: 'mm/dd/yyyy',
          startDate: null,
          endDate: new Date().toLocaleDateString('en-US', {
              month: '2-digit',
              day: '2-digit',
              year: 'numeric'
          })
        });
        $('#start-date3').datepicker({
          autoclose: true,
          format: 'mm/dd/yyyy',
          startDate: null,
          endDate: new Date().toLocaleDateString('en-US', {
              month: '2-digit',
              day: '2-digit',
              year: 'numeric'
          })
        });
        $('#start-date4').datepicker({
          autoclose: true,
          format: 'mm/dd/yyyy',
          startDate: null,
          endDate: new Date().toLocaleDateString('en-US', {
              month: '2-digit',
              day: '2-digit',
              year: 'numeric'
          })
        });
        $('#end-date').datepicker({
          autoclose: true,
          format: 'mm/dd/yyyy',
          startDate: null,
          endDate: new Date().toLocaleDateString('en-US', {
            month: '2-digit',
            day: '2-digit',
            year: 'numeric'
        })
        });
        $('#end-date1').datepicker({
          autoclose: true,
          format: 'mm/dd/yyyy',
          startDate: null,
          endDate: new Date().toLocaleDateString('en-US', {
            month: '2-digit',
            day: '2-digit',
            year: 'numeric'
        })
        });
        $('#end-date2').datepicker({
          autoclose: true,
          format: 'mm/dd/yyyy',
          startDate: null,
          endDate: new Date().toLocaleDateString('en-US', {
            month: '2-digit',
            day: '2-digit',
            year: 'numeric'
        })
        });
        $('#end-date3').datepicker({
          autoclose: true,
          format: 'mm/dd/yyyy',
          startDate: null,
          endDate: new Date().toLocaleDateString('en-US', {
            month: '2-digit',
            day: '2-digit',
            year: 'numeric'
        })
        });
        $('#end-date4').datepicker({
          autoclose: true,
          format: 'mm/dd/yyyy',
          startDate: null,
          endDate: new Date().toLocaleDateString('en-US', {
            month: '2-digit',
            day: '2-digit',
            year: 'numeric'
        })
        });
        });

        $(document).ready(function() {
        $('#start-time').timepicker({
            timeFormat: 'HH:mm',
            interval: 60,
            minTime: '00:00',
            maxTime: '23:59',
            startTime: '00:00',
            dynamic: false,
            dropdown: true,
            scrollbar: true
        });
        $('#end-time').timepicker({
            timeFormat: 'HH:mm',
            interval: 60,
            minTime: '00:00',
            maxTime: '23:59',
            startTime: '00:00',
            dynamic: false,
            dropdown: true,
            scrollbar: true
        });
        });

        function generateButton() {
            $("#students-rendered tbody tr").remove(); 
            $("#students-rendered thead tr").remove();
            event.preventDefault();
            var myForm = document.querySelector('#generate-list');
            var formData = new FormData(myForm);
            fetch('/admin/dashboard/managereport/', {
              method: 'POST',
              body: formData
            }).then(response => response.json())
            .then(data => {
              // Get the tbody element
                var tableBody = document.querySelector('#students-rendered tbody');
                var tableHeader = document.querySelector('#students-rendered thead')
                var newRowHead = document.createElement('tr');
                var start_time = new Date(data.start_time)
                var end_time = new Date(data.end_time)
                var formattedTimeStart = start_time.toLocaleTimeString('en-US', {hour: '2-digit',
                      minute: '2-digit'
                });
                var formattedTimeEnd = end_time.toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit'});
                newRowHead.className = 'text-center'
                var title_cell = document.createElement('th');
                title_cell.colSpan = '5'
                title_cell.textContent = 'Generated report from ' + new Date(data.start_date).toLocaleDateString('en-US', {
                    month: '2-digit',
                    day: '2-digit',
                    year: 'numeric'
                }) + ' to ' + new Date(data.end_date).toLocaleDateString('en-US', {
                    month: '2-digit',
                    day: '2-digit',
                    year: 'numeric'
                }) + ' from ' + formattedTimeStart + ' to ' + formattedTimeEnd
                newRowHead.appendChild(title_cell);
                tableHeader.appendChild(newRowHead);
                var newRow = document.createElement('tr');
                newRow.className = 'text-center'


                var colleges = document.createElement('th');
                colleges.textContent = "Colleges"
                var department_col = document.createElement('th');
                department_col.textContent = "Department";
                var total_col = document.createElement('th');
                total_col.textContent = "Total Number of Students"


                // Append the td elements to the tr element
                newRow.appendChild(colleges);
                newRow.appendChild(department_col);
                newRow.appendChild(total_col);

                // Append the tr element to the tbody element
                tableBody.appendChild(newRow);

                // Append the tr element to the thead element
                // Loop through the data and create a new row for each item
                var items = data.dates_login_searched;
                var data_user = data.data;
                var html = ""
                for (var i = 0; i < items.dates_login.length; i++) {
                  
                    // Create a new tr element  
                    newRow = document.createElement('tr');
                    newRow.className = 'text-center'

                    // Create td elements for each column and set their text content
                    var college_cell = document.createElement('th');
                    college_cell.textContent = data_user[i].college;
                    var deptCell = document.createElement('th');
                    deptCell.textContent = data_user[i].department;
                    var total_user_cell = document.createElement('th');
                    total_user_cell.textContent = '1';
              
                    // Append the td elements to the tr element
                    newRow.appendChild(college_cell);
                    newRow.appendChild(deptCell);
                    newRow.appendChild(total_user_cell);

                    // Append the tr element to the tbody element
                    tableBody.appendChild(newRow);
                }
              })
              .catch(error => console.error(error));
      }
      </script>
    </div>
</div>
{% endblock content %}
        